# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π Supabase

## üîç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.local)
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
OPENAI_API_KEY=sk-... (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API)
NEXT_PUBLIC_SITE_URL=http://localhost:3000 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### 2. –¢–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏:
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏, –≤–∫–ª—é—á–∞—è:
   - –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
   - Stack trace (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - URL –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑–≤–∞–ª –æ—à–∏–±–∫—É

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
const token = localStorage.getItem('jwt');
console.log('JWT —Ç–æ–∫–µ–Ω:', token ? token.substring(0, 50) + '...' : '–ù–ï–¢');
console.log('–î–ª–∏–Ω–∞ —Ç–æ–∫–µ–Ω–∞:', token?.length || 0);
console.log('–§–æ—Ä–º–∞—Ç JWT:', token && token.split('.').length === 3 ? '‚úÖ –í–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç' : '‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API
–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
fetch('/api/generate-sql', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ nl: 'test', schema: {}, dialect: 'postgres' })
})
  .then(r => r.text())
  .then(text => console.log('–õ–æ–∫–∞–ª—å–Ω—ã–π API –æ—Ç–≤–µ—Ç:', text))
  .catch(e => console.error('–û—à–∏–±–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API:', e));
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase Edge Function
–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
const token = localStorage.getItem('jwt');
const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL || 'YOUR_URL';
fetch(`${SUPABASE_URL}/functions/v1/generate_sql`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token || 'ANON_KEY'}`,
    'apikey': process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'ANON_KEY'
  },
  body: JSON.stringify({ nl: 'test', schema: {}, dialect: 'postgres' })
})
  .then(r => r.text())
  .then(text => console.log('Supabase –æ—Ç–≤–µ—Ç:', text))
  .catch(e => console.error('–û—à–∏–±–∫–∞ Supabase:', e));
```

### 6. –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
–û–ø–∏—à–∏—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–≤–µ–ª–∞ –∫ –æ—à–∏–±–∫–µ:
- –ë—ã–ª–∏ –ª–∏ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã?
- –ö–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤—Ö–æ–¥–∏–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É?
- –†–∞–±–æ—Ç–∞–ª –ª–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä SQL —Ä–∞–Ω—å—à–µ?
- –ò–∑–º–µ–Ω–∏–ª–æ—Å—å –ª–∏ —á—Ç–æ-—Ç–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö?

## üõ†Ô∏è –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid JWT" –∏–ª–∏ "401 Unauthorized"
**–ü—Ä–∏—á–∏–Ω–∞:** JWT —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–π–¥–∏—Ç–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (–∫–Ω–æ–ø–∫–∞ "Sign out")
2. –í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ —á–µ—Ä–µ–∑ `/auth`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –≤ `localStorage.getItem('jwt')`

### –ü—Ä–æ–±–ª–µ–º–∞: "OPENAI_API_KEY –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `OPENAI_API_KEY`
**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
2. –î–æ–±–∞–≤—å—Ç–µ `OPENAI_API_KEY=sk-...`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev-—Å–µ—Ä–≤–µ—Ä (`npm run dev`)

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–∫–∞–ª—å–Ω—ã–π API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, Supabase —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç `OPENAI_API_KEY` –ò –Ω–µ—Ç –≤–∞–ª–∏–¥–Ω–æ–≥–æ JWT
**–†–µ—à–µ–Ω–∏–µ:**
1. –õ–∏–±–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `OPENAI_API_KEY` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API
2. –õ–∏–±–æ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Supabase fallback

## üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env.local`
- [ ] JWT —Ç–æ–∫–µ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `localStorage`
- [ ] JWT —Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (3 —á–∞—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É)
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π API –¥–æ—Å—Ç—É–ø–µ–Ω (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω `OPENAI_API_KEY`)
- [ ] Supabase URL –∏ ANON_KEY –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (–µ—Å—Ç—å —Ç–æ–∫–µ–Ω –≤ localStorage)
- [ ] –¢–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫ (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `lib/api.ts` - –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å API –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- `pages/api/generate-sql.ts` - –ª–æ–∫–∞–ª—å–Ω—ã–π API endpoint
- `pages/auth.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `lib/supabaseClient.ts` - –∫–ª–∏–µ–Ω—Ç Supabase
