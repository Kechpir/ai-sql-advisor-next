# üîç –ê–Ω–∞–ª–∏–∑ Supabase Edge Functions

**–î–∞—Ç–∞:** 2025-12-19  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ (1/4 —Ñ—É–Ω–∫—Ü–∏–π –ø–æ–ª—É—á–µ–Ω–æ)

---

## üìã –§—É–Ω–∫—Ü–∏—è 1: `schemas`

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–∞–º–∏ –ë–î –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ Supabase Storage bucket "schemas"
- –û–ø–µ—Ä–∞—Ü–∏–∏: GET (—Å–ø–∏—Å–æ–∫), POST (save/delete/diff/update/get), DELETE

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:
1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ JWT** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ UID –∏–∑ —Ç–æ–∫–µ–Ω–∞
2. ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - —Å—Ö–µ–º—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `${uid}/` –ø–∞–ø–∫–∞—Ö
3. ‚úÖ **Checksum** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ checksum
4. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤** - —Ç–æ–ª—å–∫–æ GET, POST, DELETE
5. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - try-catch –±–ª–æ–∫

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

#### 1. ‚ùå CORS —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ origins (`"*"`)
**–†–∏—Å–∫:** CSRF –∞—Ç–∞–∫–∏, –¥–æ—Å—Ç—É–ø —Å –ª—é–±—ã—Ö –¥–æ–º–µ–Ω–æ–≤  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const allowedOrigins = [
  'https://ai-sql-advisor.vercel.app',
  'http://localhost:3000'
];
const origin = req.headers.get('origin');
const cors = {
  "Access-Control-Allow-Origin": allowedOrigins.includes(origin) ? origin : allowedOrigins[0],
  // ...
};
```

#### 2. ‚ùå –ù–µ—Ç rate limiting
**–†–∏—Å–∫:** DDoS, –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ Supabase –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å

#### 3. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ö–µ–º—ã
**–†–∏—Å–∫:** –û–≥—Ä–æ–º–Ω—ã–µ —Å—Ö–µ–º—ã –º–æ–≥—É—Ç –∑–∞–±–∏—Ç—å storage  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const MAX_SCHEMA_SIZE = 10 * 1024 * 1024; // 10MB
const schemaStr = JSON.stringify(schema);
if (schemaStr.length > MAX_SCHEMA_SIZE) {
  return new Response(JSON.stringify({error:"Schema too large"}),{status:400,...});
}
```

#### 4. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–º–µ–Ω–∏ —Å—Ö–µ–º—ã
**–†–∏—Å–∫:** Path traversal, –∏–Ω—ä–µ–∫—Ü–∏—è –≤ –ø—É—Ç—å —Ñ–∞–π–ª–∞  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
function validateSchemaName(name: string): boolean {
  // –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
  if (!/^[a-zA-Z0-9_-]+$/.test(name)) return false;
  if (name.length > 100) return false;
  if (name.includes('..') || name.includes('/')) return false;
  return true;
}
```

#### 5. ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
**–†–∏—Å–∫:** –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏–∏  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É subscription –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

#### 6. ‚ùå –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ö–µ–º
**–†–∏—Å–∫:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ç—ã—Å—è—á–∏ —Å—Ö–µ–º  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
const {data: existing} = await sb.storage.from(bucket).list(`${uid}/`);
const limit = subscription.plan === 'pro' ? 100 : 10;
if (existing.length >= limit) {
  return new Response(JSON.stringify({error:"Schema limit reached"}),{status:403,...});
}
```

#### 7. ‚ùå –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–∞—É–¥–∏—Ç)
**–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å  
**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `audit_logs`

#### 8. ‚ùå `@ts-nocheck` –æ—Ç–∫–ª—é—á–µ–Ω
**–†–∏—Å–∫:** –û—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–∞–≥–∞–º  
**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤, –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏

#### 9. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Ö–µ–º—ã
**–†–∏—Å–∫:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å JSON Schema –≤–∞–ª–∏–¥–∞—Ü–∏—é

#### 10. ‚ö†Ô∏è –£—Å—Ç–∞—Ä–µ–≤—à–∞—è –≤–µ—Ä—Å–∏—è Supabase –∫–ª–∏–µ–Ω—Ç–∞
**–†–∏—Å–∫:** –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏  
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:

### –ö—Ä–∏—Ç–∏—á–Ω–æ:
1. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
2. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏–º–µ–Ω–∏ —Å—Ö–µ–º—ã (path traversal –∑–∞—â–∏—Ç–∞)
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏
4. –î–æ–±–∞–≤–∏—Ç—å rate limiting

### –í–∞–∂–Ω–æ:
5. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Å—Ö–µ–º—ã
6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ö–µ–º –ø–æ —Ç–∞—Ä–∏—Ñ—É
7. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
8. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ TypeScript

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:
9. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Ö–µ–º—ã
10. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
11. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

---

## üìã –§—É–Ω–∫—Ü–∏—è 2: `generate_sql`

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ OpenAI API
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (DROP, DELETE, UPDATE, etc.)
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å SAVEPOINT –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:
1. ‚úÖ **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** - detectDanger —Ñ—É–Ω–∫—Ü–∏—è
2. ‚úÖ **SAVEPOINT –æ–±–µ—Ä—Ç–∫–∞** - –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä–∫–∞ `nl` –ø–æ–ª—è
4. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - try-catch –±–ª–æ–∫
5. ‚úÖ **–í–æ–∑–≤—Ä–∞—Ç usage** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–∞—Ö OpenAI

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:

#### 1. ‚ùå‚ùå‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (–ö–†–ò–¢–ò–ß–ù–û!)
**–†–∏—Å–∫:** –õ—é–±–æ–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI API –∑–∞ –≤–∞—à —Å—á–µ—Ç!  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT, –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
const auth = req.headers.get("authorization") || req.headers.get("Authorization");
if (!auth || !auth.toLowerCase().startsWith("bearer ")) {
  return new Response(JSON.stringify({error:"unauthorized"}),{status:401,...});
}
const jwt = auth.split(" ")[1];
const uid = uidFromJwt(jwt);
if (!uid) {
  return new Response(JSON.stringify({error:"invalid_jwt"}),{status:401,...});
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
const { createClient } = await import("https://esm.sh/@supabase/supabase-js@2.47.7");
const sb = createClient(SUPABASE_URL, "anon", {global:{headers:{Authorization:`Bearer ${jwt}`}}});
const {data: sub} = await sb.from("subscriptions").select("*").eq("user_id", uid).eq("status", "active").single();
if (!sub) {
  return new Response(JSON.stringify({error:"Subscription required"}),{status:403,...});
}
```

#### 2. ‚ùå CORS —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ origins (`"*"`)
**–†–∏—Å–∫:** CSRF –∞—Ç–∞–∫–∏, –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ API  
**–†–µ—à–µ–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏

#### 3. ‚ùå –ù–µ—Ç rate limiting
**–†–∏—Å–∫:** DDoS, –æ–≥—Ä–æ–º–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ OpenAI API  
**–†–µ—à–µ–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É/—á–∞—Å

#### 4. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
**–†–∏—Å–∫:** –û–≥—Ä–æ–º–Ω—ã–µ —Å—Ö–µ–º—ã ‚Üí –æ–≥—Ä–æ–º–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ç–æ–∫–µ–Ω—ã  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const MAX_NL_LENGTH = 5000; // —Å–∏–º–≤–æ–ª–æ–≤
const MAX_SCHEMA_SIZE = 100 * 1024; // 100KB
if (nl.length > MAX_NL_LENGTH) {
  return new Response(JSON.stringify({error:"Request too long"}),{status:400,...});
}
if (schemaText && schemaText.length > MAX_SCHEMA_SIZE) {
  return new Response(JSON.stringify({error:"Schema too large"}),{status:400,...});
}
```

#### 5. ‚ùå –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ç–æ–∫–µ–Ω—ã OpenAI
**–†–∏—Å–∫:** –ó–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
body: JSON.stringify({
  model: "gpt-4o-mini",
  temperature: 0.1,
  top_p: 0.9,
  max_tokens: 1000, // –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï!
  messages: [...]
})
```

#### 6. ‚ùå –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
**–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ  
**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å usage –≤ —Ç–∞–±–ª–∏—Ü—É `api_usage_logs`

#### 7. ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –ª–∏–º–∏—Ç–æ–≤
**–†–∏—Å–∫:** –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ  
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤

#### 8. ‚ùå –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç prompt injection
**–†–∏—Å–∫:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Å—Ç–∞–≤–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `nl`  
**–†–µ—à–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞

#### 9. ‚ùå `@ts-nocheck` –æ—Ç–∫–ª—é—á–µ–Ω
**–†–∏—Å–∫:** –û—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤  
**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤

#### 10. ‚ùå –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
**–†–∏—Å–∫:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã  
**–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é `generate_sql`:

### –ö–†–ò–¢–ò–ß–ù–û (—Å–¥–µ–ª–∞—Ç—å –°–†–û–ß–ù–û):
1. **–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é JWT** - –±–µ–∑ —ç—Ç–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è –≤—Å–µ—Ö!
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏** - –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
3. **–î–æ–±–∞–≤–∏—Ç—å rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è
4. **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å max_tokens** - –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–≥—Ä–æ–º–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

### –í–∞–∂–Ω–æ:
5. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–¥–ª—è –±–∏–ª–ª–∏–Ω–≥–∞)
7. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS
8. –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:
9. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
10. –ó–∞—â–∏—Ç–∞ –æ—Ç prompt injection
11. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤

---

---

## üìã –§—É–Ω–∫—Ü–∏—è 3: `fetch_schema`

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
- –ß—Ç–µ–Ω–∏–µ —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü –∏–∑ PostgreSQL –ø–æ `db_url`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü, –∫–æ–ª–æ–Ω–æ–∫, –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∏ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ READ ONLY —Ä–µ–∂–∏–º–µ

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:
1. ‚úÖ **READ ONLY —Å–µ—Å—Å–∏—è** - `BEGIN READ ONLY`
2. ‚úÖ **Statement timeout** - 5 —Å–µ–∫—É–Ω–¥
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ catalog-only —Ä–æ–ª–∏** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞
4. ‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ maxTables** - –¥–æ 2000 —Ç–∞–±–ª–∏—Ü
5. ‚úÖ **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection
6. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - try-catch –±–ª–æ–∫

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:

#### 1. ‚ùå‚ùå‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (–ö–†–ò–¢–ò–ß–ù–û!)
**–†–∏—Å–∫:** –õ—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –õ–Æ–ë–û–ô –ë–î!  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT, –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ `db_url` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
const auth = req.headers.get("authorization") || req.headers.get("Authorization");
if (!auth || !auth.toLowerCase().startsWith("bearer ")) {
  return new Response(JSON.stringify({error:"unauthorized"}),{status:401,...});
}
const jwt = auth.split(" ")[1];
const uid = uidFromJwt(jwt);
if (!uid) {
  return new Response(JSON.stringify({error:"invalid_jwt"}),{status:401,...});
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ db_url –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
const { createClient } = await import("https://esm.sh/@supabase/supabase-js@2.47.7");
const sb = createClient(SUPABASE_URL, "anon", {global:{headers:{Authorization:`Bearer ${jwt}`}}});
const {data: conn} = await sb.from("user_connections")
  .select("connection_string_encrypted")
  .eq("user_id", uid)
  .single();
// –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å db_url
```

#### 2. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ db_url
**–†–∏—Å–∫:** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —á—É–∂–∏–º –ë–î, SSRF –∞—Ç–∞–∫–∏  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
function validateDbUrl(url: string): boolean {
  // –¢–æ–ª—å–∫–æ PostgreSQL
  if (!url.startsWith("postgres://") && !url.startsWith("postgresql://")) {
    return false;
  }
  // –ó–∞–ø—Ä–µ—Ç–∏—Ç—å localhost/127.0.0.1 (SSRF)
  if (url.includes("localhost") || url.includes("127.0.0.1") || url.includes("0.0.0.0")) {
    return false;
  }
  // –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ç–∏
  if (url.includes("10.") || url.includes("192.168.") || url.includes("172.16.")) {
    return false;
  }
  return true;
}
```

#### 3. ‚ùå CORS —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ origins (`"*"`)
**–†–∏—Å–∫:** CSRF –∞—Ç–∞–∫–∏  
**–†–µ—à–µ–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏

#### 4. ‚ùå –ù–µ—Ç rate limiting
**–†–∏—Å–∫:** DDoS –Ω–∞ –ë–î –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
**–†–µ—à–µ–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

#### 5. ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
**–†–∏—Å–∫:** –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ subscription

#### 6. ‚ùå –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
**–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è  
**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å db_url (–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º)

#### 7. ‚ùå ENFORCE_CATALOG_ONLY –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true, –Ω–æ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å
**–†–∏—Å–∫:** –ï—Å–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å, –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ  
**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ —Ç—Ä–µ–±–æ–≤–∞—Ç—å catalog-only —Ä–æ–ª—å

#### 8. ‚ùå –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
**–†–∏—Å–∫:** –î–æ–ª–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –∑–∞–±–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã  
**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –µ—Å—Ç—å `statement_timeout = '5s'`, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—â–∏–π timeout

#### 9. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ö–µ–º—ã
**–†–∏—Å–∫:** SQL injection —á–µ—Ä–µ–∑ –∏–º—è —Å—Ö–µ–º—ã  
**–†–µ—à–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Å—Ö–µ–º—ã (—Ö–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è)

#### 10. ‚ùå `@ts-nocheck` –æ—Ç–∫–ª—é—á–µ–Ω
**–†–∏—Å–∫:** –û—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤  
**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é `fetch_schema`:

### –ö–†–ò–¢–ò–ß–ù–û (—Å–¥–µ–ª–∞—Ç—å –°–†–û–ß–ù–û):
1. **–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é JWT** - –±–µ–∑ —ç—Ç–æ–≥–æ –ª—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ª—é–±–æ–π –ë–î!
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å db_url –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é** - –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è db_url** - –∑–∞—â–∏—Ç–∞ –æ—Ç SSRF
4. **–í—Å–µ–≥–¥–∞ —Ç—Ä–µ–±–æ–≤–∞—Ç—å catalog-only —Ä–æ–ª—å** - –Ω–µ –ø–æ–∑–≤–æ–ª—è—Ç—å –æ—Ç–∫–ª—é—á–∞—Ç—å ENFORCE_CATALOG_ONLY

### –í–∞–∂–Ω–æ:
5. Rate limiting
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
7. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
8. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:
9. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤
10. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

---

## üìã –§—É–Ω–∫—Ü–∏—è 4: `execute_sql`

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
- –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ RPC —Ñ—É–Ω–∫—Ü–∏—é –≤ Supabase
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç SERVICE_ROLE_KEY –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:

#### 1. ‚ùå‚ùå‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (–ö–†–ò–¢–ò–ß–ù–û!)
**–†–∏—Å–∫:** –õ—é–±–æ–π –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –õ–Æ–ë–û–ô SQL –∑–∞–ø—Ä–æ—Å!  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT, –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
const auth = req.headers.get("authorization") || req.headers.get("Authorization");
if (!auth || !auth.toLowerCase().startsWith("bearer ")) {
  return new Response(JSON.stringify({error:"unauthorized"}),{status:401,...});
}
const jwt = auth.split(" ")[1];
const uid = uidFromJwt(jwt);
if (!uid) {
  return new Response(JSON.stringify({error:"invalid_jwt"}),{status:401,...});
}
```

#### 2. ‚ùå‚ùå‚ùå –ò–°–ü–û–õ–¨–ó–£–ï–¢ SERVICE_ROLE_KEY (–ö–†–ò–¢–ò–ß–ù–û!)
**–†–∏—Å–∫:** SERVICE_ROLE_KEY –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏! –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ë–î!  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ RPC —Ñ—É–Ω–∫—Ü–∏—è `execute_sql` –Ω–µ –∑–∞—â–∏—â–µ–Ω–∞, –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –õ–Æ–ë–û–ô SQL  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SERVICE_ROLE_KEY –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤!
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å anon key —Å JWT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const supabase = createClient(
  Deno.env.get("SUPABASE_URL")!,
  Deno.env.get("SUPABASE_ANON_KEY")!,
  { global: { headers: { Authorization: `Bearer ${jwt}` } } }
);
```

#### 3. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ SQL
**–†–∏—Å–∫:** SQL Injection, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π  
**–†–µ—à–µ–Ω–∏–µ:**
```typescript
function validateSQL(sql: string): boolean {
  // –¢–æ–ª—å–∫–æ SELECT –¥–ª—è read-only
  const dangerous = /(DROP|DELETE|UPDATE|INSERT|ALTER|TRUNCATE|CREATE|GRANT|REVOKE|EXEC|EXECUTE)/i;
  if (dangerous.test(sql)) return false;
  
  // –ó–∞–ø—Ä–µ—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
  const systemTables = /(pg_|information_schema|sys\.|mysql\.)/i;
  if (systemTables.test(sql)) return false;
  
  // –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
  if (sql.split(';').filter(s => s.trim()).length > 1) return false;
  
  return true;
}
```

#### 4. ‚ùå –ù–µ—Ç CORS –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
**–†–∏—Å–∫:** CSRF –∞—Ç–∞–∫–∏  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏

#### 5. ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
**–†–∏—Å–∫:** –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ subscription

#### 6. ‚ùå –ù–µ—Ç rate limiting
**–†–∏—Å–∫:** DDoS –Ω–∞ –ë–î  
**–†–µ—à–µ–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

#### 7. ‚ùå –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
**–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã  
**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã (–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

#### 8. ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
**–†–∏—Å–∫:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ —á—É–∂–æ–π –ë–î  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ SQL –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ë–î –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 9. ‚ùå –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
**–†–∏—Å–∫:** –î–æ–ª–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –∑–∞–±–∏—Ç—å –ë–î  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å timeout

#### 10. ‚ùå –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
**–†–∏—Å–∫:** –û–≥—Ä–æ–º–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç –∑–∞–±–∏—Ç—å –ø–∞–º—è—Ç—å  
**–†–µ—à–µ–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é `execute_sql`:

### –ö–†–ò–¢–ò–ß–ù–û (—Å–¥–µ–ª–∞—Ç—å –°–†–û–ß–ù–û!):
1. **–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é JWT** - –±–µ–∑ —ç—Ç–æ–≥–æ –ª—é–±–æ–π –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±–æ–π SQL!
2. **–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SERVICE_ROLE_KEY** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å anon key —Å JWT
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è SQL** - —Ç–æ–ª—å–∫–æ SELECT, –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏** - –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

### –í–∞–∂–Ω–æ:
5. Rate limiting
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤
7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
8. CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
9. Timeout –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
10. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:
11. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
12. –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üìä –ò–¢–û–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó –í–°–ï–• –§–£–ù–ö–¶–ò–ô

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º:

| –§—É–Ω–∫—Ü–∏—è | –ö—Ä–∏—Ç–∏—á–Ω—ã—Ö | –í–∞–∂–Ω—ã—Ö | –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö |
|---------|-----------|--------|-------------|
| `schemas` | 4 | 6 | 3 |
| `generate_sql` | 4 | 4 | 3 |
| `fetch_schema` | 4 | 4 | 2 |
| `execute_sql` | 4 | 6 | 2 |
| **–ò–¢–û–ì–û** | **16** | **20** | **10** |

### –û–±—â–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. ‚ùå‚ùå‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - –≤—Å–µ 4 —Ñ—É–Ω–∫—Ü–∏–∏!
2. ‚ùå‚ùå‚ùå **CORS —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ origins** - –≤—Å–µ 4 —Ñ—É–Ω–∫—Ü–∏–∏!
3. ‚ùå‚ùå‚ùå **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏** - –≤—Å–µ 4 —Ñ—É–Ω–∫—Ü–∏–∏!
4. ‚ùå‚ùå‚ùå **–ù–µ—Ç rate limiting** - –≤—Å–µ 4 —Ñ—É–Ω–∫—Ü–∏–∏!
5. ‚ùå‚ùå‚ùå **–ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** - –≤—Å–µ 4 —Ñ—É–Ω–∫—Ü–∏–∏!

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

#### –§–∞–∑–∞ 1 (–ö–†–ò–¢–ò–ß–ù–û - —Å–¥–µ–ª–∞—Ç—å –°–ï–ì–û–î–ù–Ø):
1. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é JWT –≤–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ –≤–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
3. –£–±—Ä–∞—Ç—å SERVICE_ROLE_KEY –∏–∑ `execute_sql`
4. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é SQL –≤ `execute_sql`

#### –§–∞–∑–∞ 2 (–í–ê–ñ–ù–û - —Å–¥–µ–ª–∞—Ç—å –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ):
5. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
6. –î–æ–±–∞–≤–∏—Ç—å rate limiting
7. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
8. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### –§–∞–∑–∞ 3 (–ñ–ï–õ–ê–¢–ï–õ–¨–ù–û - —Å–¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü):
9. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
10. –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
11. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ TypeScript

---

**–°—Ç–∞—Ç—É—Å –∞–Ω–∞–ª–∏–∑–∞:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù** (4/4 —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
