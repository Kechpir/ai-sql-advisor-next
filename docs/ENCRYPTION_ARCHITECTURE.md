# ğŸ” ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ connection strings

## ğŸ“Š ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ĞšĞ»Ğ¸ĞµĞ½Ñ‚    â”‚         â”‚ Next.js API  â”‚         â”‚   Supabase  â”‚
â”‚  (Ğ‘Ñ€Ğ°ÑƒĞ·ĞµÑ€)  â”‚         â”‚ (Vercel)     â”‚         â”‚   (Ğ‘Ğ”)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚                         â”‚
       â”‚ connectionString      â”‚                         â”‚
       â”‚ (Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚)      â”‚                         â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
       â”‚                       â”‚                         â”‚
       â”‚                       â”‚ encrypt()               â”‚
       â”‚                       â”‚ + ENCRYPTION_KEY        â”‚
       â”‚                       â”‚ = encryptedString       â”‚
       â”‚                       â”‚                         â”‚
       â”‚                       â”‚ encryptedString         â”‚
       â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                       â”‚                         â”‚ Ğ¥Ğ ĞĞĞ˜Ğ¢
       â”‚                       â”‚                         â”‚ (user_connections)
       â”‚                       â”‚                         â”‚
       â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                       â”‚ encryptedString         â”‚
       â”‚                       â”‚                         â”‚
       â”‚                       â”‚ decrypt()               â”‚
       â”‚                       â”‚ + ENCRYPTION_KEY        â”‚
       â”‚                       â”‚ = connectionString      â”‚
       â”‚                       â”‚                         â”‚
       â”‚ connectionString      â”‚                         â”‚
       â”‚ (Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚)      â”‚                         â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
       â”‚                       â”‚                         â”‚
```

## ğŸ” Ğ“Ğ´Ğµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ?

### âœ… Next.js API Routes (Vercel)

Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ/Ğ´ĞµÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² **Next.js API routes**, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Vercel:

- `pages/api/save-connection.ts` - ÑˆĞ¸Ñ„Ñ€ÑƒĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ĞµĞ¼
- `lib/encryption.ts` - Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ `encrypt()` Ğ¸ `decrypt()`
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `process.env.ENCRYPTION_KEY` Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Vercel

### âŒ ĞĞ• Ğ² Supabase

Supabase **ĞĞ• Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ**. ĞĞ½ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾:
- ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ÑƒĞ¶Ğµ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
- Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ¸Ñ… Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ `user_connections.connection_string_encrypted`
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°Ñ…

---

## ğŸ¯ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ĞºĞ»ÑÑ‡ Ğ² Vercel, Ğ° Ğ½Ğµ Ğ² Supabase?

### 1. **Ğ“Ğ´Ğµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** = Ğ³Ğ´Ğµ Ğ½ÑƒĞ¶ĞµĞ½ ĞºĞ»ÑÑ‡

```typescript
// pages/api/save-connection.ts (Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ½Ğ° Vercel)
import { encrypt } from '@/lib/encryption';

const encryptedConnectionString = encrypt(connectionString); // â† Ğ—Ğ´ĞµÑÑŒ Ğ½ÑƒĞ¶ĞµĞ½ ENCRYPTION_KEY
```

ĞšĞ»ÑÑ‡ Ğ½ÑƒĞ¶ĞµĞ½ Ñ‚Ğ°Ğ¼, Ğ³Ğ´Ğµ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ `encrypt()` / `decrypt()`, Ğ° ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Next.js ĞºĞ¾Ğ´Ğµ Ğ½Ğ° Vercel.

### 2. **Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸**

- **Vercel (Next.js):** Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°, ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
- **Supabase:** Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑƒĞ¶Ğµ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)

### 3. **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ**

- ĞšĞ»ÑÑ‡ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Next.js Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸
- Supabase Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ĞºĞ»ÑÑ‡Ñƒ
- Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Supabase Ğ±ÑƒĞ´ĞµÑ‚ ÑĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½, Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ÑÑ‚Ğ°Ğ½ÑƒÑ‚ÑÑ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸

---

## ğŸ”„ ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ

### Ğ¨Ğ°Ğ³ 1: ĞšĞ»Ğ¸ĞµĞ½Ñ‚ â†’ Next.js API
```typescript
// components/connections/SimpleDbConnect.tsx
const res = await fetch("/api/save-connection", {
  method: "POST",
  body: JSON.stringify({
    name: "my-db",
    connectionString: "postgresql://user:pass@host/db" // â† Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
  })
});
```

### Ğ¨Ğ°Ğ³ 2: Next.js API ÑˆĞ¸Ñ„Ñ€ÑƒĞµÑ‚
```typescript
// pages/api/save-connection.ts
import { encrypt } from '@/lib/encryption';

const encrypted = encrypt(connectionString); 
// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ process.env.ENCRYPTION_KEY (Ğ¸Ğ· Vercel)
// Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: "iv:tag:encryptedData" (base64)
```

### Ğ¨Ğ°Ğ³ 3: Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Supabase
```typescript
// pages/api/save-connection.ts
await supabase
  .from("user_connections")
  .upsert({
    connection_string_encrypted: encrypted, // â† ÑƒĞ¶Ğµ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾
    // ...
  });
```

### Ğ¨Ğ°Ğ³ 4: Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Supabase
```typescript
// pages/api/save-connection.ts (GET)
const { data } = await supabase
  .from("user_connections")
  .select("connection_string_encrypted");

// data[0].connection_string_encrypted = "iv:tag:encryptedData"

const decrypted = decrypt(data[0].connection_string_encrypted);
// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ process.env.ENCRYPTION_KEY (Ğ¸Ğ· Vercel)
// Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: "postgresql://user:pass@host/db" (Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚)
```

---

## ğŸ’¡ Ğ Ñ‡Ñ‚Ğ¾ ĞµÑĞ»Ğ¸ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡ Ğ² Supabase?

Ğ¢ĞµĞ¾Ñ€ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ Ğ±Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Supabase Edge Functions Ğ´Ğ»Ñ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ, Ğ½Ğ¾:

### âŒ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸:
1. **Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ** - Ğ½ÑƒĞ¶Ğ½Ñ‹ Edge Functions
2. **Ğ›Ğ°Ñ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ** - Ğ»Ğ¸ÑˆĞ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº Supabase
3. **ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°** - Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ Ğ² Next.js Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸
4. **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - ĞºĞ»ÑÑ‡ Ğ²ÑĞµ Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ³Ğ´Ğµ-Ñ‚Ğ¾ (Ğ² Supabase Secrets)

### âœ… Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ğ»ÑƒÑ‡ÑˆĞµ:
1. **ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ°** - Ğ²ÑĞµ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ (Next.js)
2. **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ñ‚Ğ¾Ğ¼ Ğ¶Ğµ ÑĞµÑ€Ğ²ĞµÑ€Ğµ
3. **Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ** - Supabase Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚, Ğ½Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚
4. **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - ĞºĞ»ÑÑ‡ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² Next.js Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸

---

## ğŸ“ Ğ˜Ñ‚Ğ¾Ğ³Ğ¾

**ENCRYPTION_KEY Ğ½ÑƒĞ¶ĞµĞ½ Ğ² Vercel**, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾:
- âœ… Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Next.js API routes
- âœ… Next.js API routes Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Vercel
- âœ… Vercel Ğ¸Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Next.js Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- âœ… Supabase Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ, Ğ½Ğµ ÑˆĞ¸Ñ„Ñ€ÑƒĞµÑ‚ Ğ¸Ñ…

