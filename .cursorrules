# AI SQL Advisor Next.js - Project Context

## üéØ Project Overview
Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é AI. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö, –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å—Ö–µ–º—ã –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ.

**Production URL**: https://ai-sql-advisor.vercel.app
**GitHub**: https://github.com/Kechpir/ai-sql-advisor-next
**–û—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞**: `main` (–≤–µ—Ç–∫–∞ `stage` —É–¥–∞–ª–µ–Ω–∞)

## üèóÔ∏è Architecture

### Frontend (Next.js)
- **Framework**: Next.js 14.2.33
- **UI**: React 18.2.0, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Styling**: Inline styles + CSS —Ñ–∞–π–ª—ã
- **Routing**: Next.js App Router (pages directory)

### Backend
- **Local API**: `/pages/api/*` - –ª–æ–∫–∞–ª—å–Ω—ã–µ Next.js API routes (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ Supabase)
- **Supabase**: Edge Functions –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∏ —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ö–µ–º–∞–º–∏ (fallback)
- **AI**: OpenAI API (GPT-4o-mini) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL
- **Supabase URL**: https://zaheofzxbfqabdxdmjtz.supabase.co
- **Project Ref**: zaheofzxbfqabdxdmjtz

### Key Technologies
- TypeScript
- Supabase (Auth, Edge Functions, Storage)
- OpenAI API
- PostgreSQL, MySQL, SQLite support
- xlsx library –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel —Ñ–∞–π–ª–æ–≤

## üìÅ Project Structure

```
/
‚îú‚îÄ‚îÄ components/          # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)
‚îÇ   ‚îú‚îÄ‚îÄ auth/           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OAuthHashHandler.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ForceGoogleLogin.tsx
‚îÇ   ‚îú‚îÄ‚îÄ connections/   # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DbConnect.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SimpleDbConnect.tsx
‚îÇ   ‚îú‚îÄ‚îÄ tables/         # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–∞–±–ª–∏—Ü –∏ –º–æ–¥–∞–ª–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DataTable.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DataTableModal.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TableTabsBar.tsx
‚îÇ   ‚îú‚îÄ‚îÄ sql/            # SQL-—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SqlDialectSelect.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SqlResult.tsx
‚îÇ   ‚îú‚îÄ‚îÄ common/          # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FileUpload.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SchemasManager.tsx
‚îÇ   ‚îú‚îÄ‚îÄ layout/         # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–∞–∫–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppLayout.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SidebarMenu.tsx
‚îÇ   ‚îú‚îÄ‚îÄ SqlBuilderPanel/ # SQL –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (BaseSqlPanel, AdvancedSqlPanel, ExpertSqlPanel)
‚îÇ   ‚îî‚îÄ‚îÄ ui/             # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ       ‚îî‚îÄ‚îÄ Panel.tsx
‚îú‚îÄ‚îÄ pages/              # Next.js pages
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx       # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (SQL –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å AI)
‚îÇ   ‚îú‚îÄ‚îÄ sql-interface.tsx # SQL –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ builder.tsx     # SQL Builder —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ auth.tsx        # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ api/            # API endpoints
‚îÇ       ‚îú‚îÄ‚îÄ generate-sql.ts # –õ–æ–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL (OpenAI)
‚îÇ       ‚îú‚îÄ‚îÄ fetch-schema.ts  # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ lib/                # –£—Ç–∏–ª–∏—Ç—ã –∏ API –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ api.ts          # API –∫–ª–∏–µ–Ω—Ç (Supabase + –ª–æ–∫–∞–ª—å–Ω—ã–π fallback)
‚îÇ   ‚îú‚îÄ‚îÄ db/             # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jsonToSql.ts # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è JSON –≤ SQL
‚îÇ   ‚îú‚îÄ‚îÄ supabaseClient.ts
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts
‚îî‚îÄ‚îÄ styles/             # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
    ‚îî‚îÄ‚îÄ main.css
```

## üîë Key Features

### 1. SQL Generation
- **–õ–æ–∫–∞–ª—å–Ω—ã–π API**: `/api/generate-sql` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI –Ω–∞–ø—Ä—è–º—É—é (—Ç—Ä–µ–±—É–µ—Ç OPENAI_API_KEY)
- **Supabase Fallback**: –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Supabase Edge Function `generate_sql`
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –¢–æ–ª—å–∫–æ SELECT –∑–∞–ø—Ä–æ—Å—ã, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (DROP, DELETE, etc.)

### 2. Supabase Edge Functions
–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å—É: `https://zaheofzxbfqabdxdmjtz.supabase.co/functions/v1/`

| –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | Endpoint |
|---------|------------|----------|
| `execute_sql` | –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ | `/functions/v1/execute_sql` |
| `fetch_schema` | –ü–æ–ª—É—á–∞–µ—Ç —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü –∏–∑ –≤–Ω–µ—à–Ω–µ–π –ë–î (Postgres, Neon, etc.) | `/functions/v1/fetch_schema` |
| `generate_sql` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ natural language (AI) | `/functions/v1/generate_sql` |
| `schemas` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ —Å—Ö–µ–º–∞–º–∏ | `/functions/v1/schemas` |

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **CORS** –∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ `POST`, –≤–æ–∑–≤—Ä–∞—â–∞—è JSON.

**–î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π:**
```bash
supabase functions deploy <function-name> --project-ref zaheofzxbfqabdxdmjtz
```

**–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞** (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω `supabase start`):
- `localhost:54321/functions/v1/...`

### 3. File Upload & Analysis
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤: `.sql`, `.csv`, `.xlsx`, `.xls`, `.json`, `.txt`
- –ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ SQL –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- Excel —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `xlsx`

### 4. Database Connection
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL, MySQL, SQLite
- Read-only –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î

### 5. Authentication
- Supabase Auth (Google OAuth)
- JWT —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

## üîß Important Patterns

### API Client Pattern (`lib/api.ts`)
```typescript
// –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ª–æ–∫–∞–ª—å–Ω—ã–π API ‚Üí Supabase (–µ—Å–ª–∏ –µ—Å—Ç—å JWT)
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
// - –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏ –Ω–µ—Ç JWT ‚Üí –æ—à–∏–±–∫–∞
// - –ï—Å–ª–∏ Supabase –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 ‚Üí –æ—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞
// - –í–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ñ–æ—Ä–º–∞—Ç–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
```

### Component Structure
- **BaseSqlPanel**: –ë–∞–∑–æ–≤—ã–µ SQL –æ–ø–µ—Ä–∞—Ü–∏–∏ (SELECT, WHERE, ORDER BY, LIMIT)
- **AdvancedSqlPanel**: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (JOIN, GROUP BY, HAVING)
- **ExpertSqlPanel**: –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (CTE, Window Functions, JSON)

### State Management
- React useState –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- localStorage –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- Props drilling –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

## ‚ö†Ô∏è Important Notes

### JWT Token Handling
- –¢–æ–∫–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Ñ–æ—Ä–º–∞—Ç (3 —á–∞—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É)
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- –ü—Ä–∏ –æ—à–∏–±–∫–µ 401 –æ—Ç Supabase —Ç–æ–∫–µ–Ω –æ—á–∏—â–∞–µ—Ç—Å—è

### Error Handling
- –õ–æ–∫–∞–ª—å–Ω—ã–π API –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ Supabase
- –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Supabase —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JWT
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### File Processing
- –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (SQL, TXT): –ø—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ
- CSV: –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- JSON: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- Excel: —á—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤
- PDF/DOC: –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

## üêõ Known Issues & Solutions

### Issue: "Invalid JWT" –æ—à–∏–±–∫–∞
**–ü—Ä–∏—á–∏–Ω–∞**: –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### Issue: –õ–æ–∫–∞–ª—å–Ω—ã–π API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Ç OPENAI_API_KEY –≤ .env.local
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase —Å –≤–∞–ª–∏–¥–Ω—ã–º JWT

### Issue: –ò–º–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å index.tsx —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–∞—Ö –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤

## üìù Development Guidelines

### Adding New Features
1. –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–∞–ø–∫–∞—Ö `components/`:
   - `auth/` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   - `connections/` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
   - `tables/` - —Ç–∞–±–ª–∏—Ü—ã –∏ –º–æ–¥–∞–ª–∫–∏
   - `sql/` - SQL-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - `common/` - –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - `layout/` - –º–∞–∫–µ—Ç
2. API endpoints –≤ `pages/api/`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypeScript —Ç–∏–ø—ã
4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### Styling
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å inline styles –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –≤ `styles/main.css`
- –°–ª–µ–¥–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Å—Ç–∏–ª—é (—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã)

### Testing
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–±–æ—Ç—É –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API –∏ Supabase fallback
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é JWT —Ç–æ–∫–µ–Ω–æ–≤

## üîê Environment Variables

### Vercel Production
```env
NEXT_PUBLIC_SUPABASE_URL=https://zaheofzxbfqabdxdmjtz.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=<anon-key>
SUPABASE_SERVICE_KEY=<service-key>
OPENAI_API_KEY=... # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### Local Development
```env
NEXT_PUBLIC_SUPABASE_URL=https://zaheofzxbfqabdxdmjtz.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=<anon-key>
OPENAI_API_KEY=... # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ API
```

## üåç Deployment & URLs

### Vercel
- **Production URL**: https://ai-sql-advisor.vercel.app
- **Build Command**: `npm run build`
- **Output Directory**: `.` (Next.js auto)

### Supabase Auth Configuration
- **Site URL**: https://ai-sql-advisor.vercel.app
- **Redirect URLs**:
  - `https://ai-sql-advisor.vercel.app/*`
  - `http://localhost:3000/*`

### PostgreSQL / Neon DB Example
```
postgresql://neondb_owner:npg_Kpne6AbEOx1s@ep-weathered-scene-ag47iood-pooler.c-2.eu-central-1.aws.neon.tech/neondb?sslmode=require
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| Host | ep-weathered-scene-ag47iood-pooler.c-2.eu-central-1.aws.neon.tech |
| Port | 5432 |
| Database | neondb |
| User | neondb_owner |
| Password | npg_Kpne6AbEOx1s |
| SSL Mode | require |

## üìö Key Dependencies
- next: ^14.2.33
- react: 18.2.0
- @supabase/supabase-js: ^2.47.7
- xlsx: –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel
- pg, mysql2, sqlite3: –¥—Ä–∞–π–≤–µ—Ä—ã –ë–î

## üé® UI/UX Patterns
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏
- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- Drag & drop –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
- Responsive –¥–∏–∑–∞–π–Ω

## üöÄ Deployment

### Vercel
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ –ø—É—à–µ –≤ `main` –≤–µ—Ç–∫—É
- Production URL: https://ai-sql-advisor.vercel.app

### Supabase Edge Functions
–î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π —á–µ—Ä–µ–∑ Supabase CLI:
```bash
supabase functions deploy <function-name> --project-ref zaheofzxbfqabdxdmjtz
```

–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω `supabase start`):
- `localhost:54321/functions/v1/...`

## üß† –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è (—á–µ—Ä–µ–∑ Supabase Auth)
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ö–µ–º—É —Å–≤–æ–µ–π –ë–î (`fetch_schema`)
3. –í–≤–æ–¥–∏—Ç –∑–∞–¥–∞—á—É –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–π SQL-–∑–∞–ø—Ä–æ—Å
4. AI (—á–µ—Ä–µ–∑ Edge Function `generate_sql` –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π API) —Å–æ–∑–¥–∞—ë—Ç SQL
5. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç SQL (`execute_sql`)
6. –í—Å—ë —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ñ—Ä–æ–Ω—Ç–æ–º (Next.js) –∏ API (`/lib/api.ts`)

## üìù API Client (`lib/api.ts`)

–§–∞–π–ª `/lib/api.ts` —Å–≤—è–∑—ã–≤–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç —Å Supabase Edge Functions:

```typescript
// –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ª–æ–∫–∞–ª—å–Ω—ã–π API ‚Üí Supabase (–µ—Å–ª–∏ –µ—Å—Ç—å JWT)
export async function fetchSchema(db_url: string, schema = 'public')
export async function generateSql(nl: string, schemaJson: any, dialect: string)
export async function executeSql(sql: string) // —á–µ—Ä–µ–∑ Supabase
export async function saveSchema(name: string, schema: any)
export async function getSchema(name: string)
```

**–í–∞–∂–Ω–æ**: 
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `/lib/api.ts`
- Edge Functions —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ "—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞" –ø—Ä–æ–µ–∫—Ç–∞ (–∑–∞–º–µ–Ω–∞ backend API)
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å SQL –∏ —Å—Ö–µ–º–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Supabase Edge Functions
- AI –≤—ã–∑—ã–≤–∞–µ—Ç `generate_sql` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Üí `execute_sql` –∏—Å–ø–æ–ª–Ω—è–µ—Ç –µ–≥–æ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ñ—Ä–æ–Ω—Ç—É

## üß∞ Cursor / AI Context Notes

* –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `/lib/api.ts`
* Edge Functions —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ "—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞" –ø—Ä–æ–µ–∫—Ç–∞ (–∑–∞–º–µ–Ω–∞ backend API)
* –ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∏—Ö –¥–µ–ø–ª–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ Supabase CLI
* –ü—Ä–∏ —Ç–µ—Å—Ç–∞—Ö ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `localhost:54321/functions/v1/...` (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω `supabase start`)
* –†–∞–±–æ—Ç–∞ –≤–µ–¥—ë—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Cursor (IDE —Å AI), –≤–µ—Ç–∫–∞ `stage` –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞
* –í—Å—ë –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å SQL –∏ —Å—Ö–µ–º–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Supabase Edge Functions
